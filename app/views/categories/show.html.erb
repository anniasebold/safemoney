<% @title="SafeMoney" %>
<div id="index-post">
  <div class="container">
    <div class="row">
      
      <!-- Principal Body -->
      <div class="col-md-8">
        <h1 class="my-4">
          Postagens da Categoria
        </h1>
        <div class="alert alert-info">
          <h2><%= @categorie.name %></h2>
        </div> 

      <% if @post.present? %>
        <% @post.each do |post| %>
          <div class="card mb-4">
            <!-- Card header -->
            <div class="card-header">
              <h2 class="card-title"><%= post.title %></h2>
              <% post.categories.each do |categorie| %>
                <%= link_to categorie.name, root_path, class: 'badge badge-info'%>
              <% end %>
            </div>
            <!-- Card body -->
            <div class="card-body">
                <%= image_tag(post.image, class: "img-fluid") if post.image.attached? %>  
              <p class="card-text"><%= post.text.truncate(250) %></p>
              
              <!-- Btn Read More -->
              <div class="d-flex">
                <div class="mr-auto align-self-center p-2">
                  <%= link_to post_path(post.id), class:"btn btn-primary" do %>
                    Leia mais
                    <i class="fas fa-arrow-right"></i>
                  <% end %>
                </div>
                <% if post.user.email == current_user.email %>
                  <%= link_to "Editar", edit_post_path(post.id), class: "btn btn-light align-self-center p-2 ml-2 mr-3 " %>
                  <%= link_to "Excluir", post_path(post.id), method: :delete, class: "btn btn-danger align-self-center p-2", data: {confirm: "Tem certeza que deseja remover a postagem #{post.title}?"} %>
                <% else %>
                  <%= link_to "Reportar", root_path, class: "btn btn-danger align-self-center p-2 ml-2" %>
                <% end %>
              </div>
            </div>
            <!-- Card footer -->
            <div class="card-footer text-muted">
                Postado em <%= l(post.created_at, format: :long) %>
                  por
                <%= link_to post.user.name, user_path(post.user.id) %>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="alert alert-danger">
          Essa categoria não possui postagens ainda. Aproveite e faça uma postagem sobre <%= @categorie.name %>!
        </div>
      <% end %>

      </div>

      <!-- Side Body -->
      <div class="col-md-4">

        <!-- Categories Widget -->
        <div class="card my-4">
          <h5 class="card-header">Categorias</h5>
            <div class="row">
              <div class="col-lg-12">
                <ul class="list-group">
                  <% @categories.each do |categorie| %>
                    <% if categorie.id == @categorie.id %>
                     <%= link_to categorie.name, category_path(categorie.id), class: "list-group-item list-group-item-action active" %>
                    <% else %>
                      <%= link_to categorie.name, category_path(categorie.id), class: "list-group-item list-group-item-action" %>
                    <% end %>
                  <% end %>
                </ul>
              </div>
            </div>
        </div>

      </div>

    </div>
  </div>
</div>
